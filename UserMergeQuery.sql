DROP TABLE IF EXISTS usermigration;

create table usermigration
(
oldusername varchar(255),
newusername varchar(255)
);

/*
insert into usermigration (oldusername, newusername) values ('felix henon','soft_poly');
*/
/*
insert into usermigration (oldusername, newusername) values ('ikhedhiri','ines.khedhiri');
insert into usermigration (oldusername, newusername) values ('ikhediri','ines.khedhiri');
*/
/*
insert into usermigration (oldusername, newusername) values ('rriou','Rodolph.Riou');
insert into usermigration (oldusername, newusername) values ('integration','Rodolph.Riou');
*/

insert into usermigration (oldusername, newusername) values ('adelhors','arnaud.delhors');
insert into usermigration (oldusername, newusername) values ('ael-harraq','Abderrazak.El-Harraq');
insert into usermigration (oldusername, newusername) values ('afortune','adrien.fortune');
insert into usermigration (oldusername, newusername) values ('adrien.fortune','adrien.fortune');
insert into usermigration (oldusername, newusername) values ('anedelle','Alain.Nedellec');
insert into usermigration (oldusername, newusername) values ('aoutrey','Armelle.Outrey');
insert into usermigration (oldusername, newusername) values ('asamimi','Ali.Samimi');
insert into usermigration (oldusername, newusername) values ('atrela','Andre.Trela');
insert into usermigration (oldusername, newusername) values ('aviala','Adrien.Viala');
insert into usermigration (oldusername, newusername) values ('baabelka','B.Ait-Ali-Belkacem');
insert into usermigration (oldusername, newusername) values ('bderouin','Bastien.Derouineau');
insert into usermigration (oldusername, newusername) values ('bkarmouc','Brahim.Karmouche');
insert into usermigration (oldusername, newusername) values ('briquet','b.riquet');
insert into usermigration (oldusername, newusername) values ('brolet','Bruno.Rolet');
insert into usermigration (oldusername, newusername) values ('bsaraiva','Bertrand.Saraiva');
insert into usermigration (oldusername, newusername) values ('cbellan','Christophe.Bellan');
insert into usermigration (oldusername, newusername) values ('cdelacru','Carlos.De-La-Cruz');
insert into usermigration (oldusername, newusername) values ('cfleurentin','c.fleurentin');
insert into usermigration (oldusername, newusername) values ('cjeanney','Christine.Jeanney');
insert into usermigration (oldusername, newusername) values ('ddouillard','Daniel.Douillard');
insert into usermigration (oldusername, newusername) values ('ebervas','Elodie.Bervas');
insert into usermigration (oldusername, newusername) values ('echevalier','Elisabeth.Chevalier');
insert into usermigration (oldusername, newusername) values ('edelaplace','Etienne.Delaplace');
insert into usermigration (oldusername, newusername) values ('epizard','Eric.Izard');
insert into usermigration (oldusername, newusername) values ('equero','Eric.Quero');
insert into usermigration (oldusername, newusername) values ('fbaudemont','Frederic.Baudemont');
insert into usermigration (oldusername, newusername) values ('fbeaufrere','Florence.Beaufrere');
insert into usermigration (oldusername, newusername) values ('fbenbekhti','farid.benbekhti');
insert into usermigration (oldusername, newusername) values ('fbigot','Francois.Bigot');
insert into usermigration (oldusername, newusername) values ('ffraslin','Frederic.Fraslin');
insert into usermigration (oldusername, newusername) values ('frouvery','Fabien.Rouvery');
insert into usermigration (oldusername, newusername) values ('gbazat','Guillaume.Bazat');
insert into usermigration (oldusername, newusername) values ('gcasse','Gilles.Casse');
insert into usermigration (oldusername, newusername) values ('hchouket','Houda.Chouket');
insert into usermigration (oldusername, newusername) values ('houda.chouket','Houda.Chouket');
insert into usermigration (oldusername, newusername) values ('hsedjane','hamid.sedjane');
insert into usermigration (oldusername, newusername) values ('ines.khedhiri','ines.khedhiri');
insert into usermigration (oldusername, newusername) values ('indoye','Ibrahima.Ndoye');
insert into usermigration (oldusername, newusername) values ('jcbouver','Jeanclement.Bouveres');
insert into usermigration (oldusername, newusername) values ('jccalvez','JC.Calvez');
insert into usermigration (oldusername, newusername) values ('jcossart','James.Cossart');
insert into usermigration (oldusername, newusername) values ('jdossant','Jose.Dos-Santos');
insert into usermigration (oldusername, newusername) values ('jfmoenne','Jean-Francois.Moenne');
insert into usermigration (oldusername, newusername) values ('jfournie','Julien.Fournier');
insert into usermigration (oldusername, newusername) values ('jlevy','joelle.levy');
insert into usermigration (oldusername, newusername) values ('jmgiraul','Jean-Marie.Girault');
insert into usermigration (oldusername, newusername) values ('jmvillard','jvillard');
insert into usermigration (oldusername, newusername) values ('jpdubuc','Jean-Pierre.Dubuc');
insert into usermigration (oldusername, newusername) values ('jvigneron','Jeanmichel.Vigneron');
insert into usermigration (oldusername, newusername) values ('kmartineau','Kevin.Martineau');
insert into usermigration (oldusername, newusername) values ('kmartine','Kevin.Martineau');
insert into usermigration (oldusername, newusername) values ('lnolius','Laurent.Nolius');
insert into usermigration (oldusername, newusername) values ('lpelletier','Lionel.Pelletier');
insert into usermigration (oldusername, newusername) values ('lsigni','Laetitia.Signi');
insert into usermigration (oldusername, newusername) values ('mcastanares','Mariano.Castanares');
insert into usermigration (oldusername, newusername) values ('mcerez','Michel.Cerez');
insert into usermigration (oldusername, newusername) values ('mdelegli','Mickael.Deleglise');
insert into usermigration (oldusername, newusername) values ('mgrant','marc.grant');
insert into usermigration (oldusername, newusername) values ('mszerwin','Marc.Szerwiniack');
insert into usermigration (oldusername, newusername) values ('nbaillette','nicolas.baillette');
insert into usermigration (oldusername, newusername) values ('nhinkle','Natalie.Hinkle');
insert into usermigration (oldusername, newusername) values ('npatou','Nicolas.Patou');
insert into usermigration (oldusername, newusername) values ('obegarie','Olivier.Begarie');
insert into usermigration (oldusername, newusername) values ('ogranger','Olivier.Granger');
insert into usermigration (oldusername, newusername) values ('oloones','Olivier.Loones');
insert into usermigration (oldusername, newusername) values ('oville','Olivier.Ville');
insert into usermigration (oldusername, newusername) values ('pfoulon','Patrick.Foulon');
insert into usermigration (oldusername, newusername) values ('pinthavo','Phone.Inthavong');
insert into usermigration (oldusername, newusername) values ('plefebvr','Philippe.Lefebvre');
insert into usermigration (oldusername, newusername) values ('pmillet','Pierre.Millet');
insert into usermigration (oldusername, newusername) values ('pseban','Pierre.Seban');
insert into usermigration (oldusername, newusername) values ('rmichel','Romain.Michel');
insert into usermigration (oldusername, newusername) values ('rrodrigu','Ruben.Rodrigues');
insert into usermigration (oldusername, newusername) values ('sbernard','Sebastien.Bernard');
insert into usermigration (oldusername, newusername) values ('scoquibu','Stephane.Coquibus');
insert into usermigration (oldusername, newusername) values ('sniez','Sandrine.Niez');
insert into usermigration (oldusername, newusername) values ('sriche','Stephane.Riche');
insert into usermigration (oldusername, newusername) values ('sslime','Samir.Slime');
insert into usermigration (oldusername, newusername) values ('tbonnet','Thierry.Bonnet');
insert into usermigration (oldusername, newusername) values ('tneusius','Thierry.Neusius');
insert into usermigration (oldusername, newusername) values ('ttoulouse','Tony.Toulouse');
insert into usermigration (oldusername, newusername) values ('vcarrico','vasco.carrico');
insert into usermigration (oldusername, newusername) values ('vdobler','Vincent.Dobler');
insert into usermigration (oldusername, newusername) values ('vtran','Victor.Tran');
insert into usermigration (oldusername, newusername) values ('wlenormand','william.le-normand');
insert into usermigration (oldusername, newusername) values ('xverne','xaverne');
insert into usermigration (oldusername, newusername) values ('yclorenn','Yvon.Clorennec');
insert into usermigration (oldusername, newusername) values ('yodemer','Yoann.Odemer');
insert into usermigration (oldusername, newusername) values ('bpanloup','boris.panloup');
insert into usermigration (oldusername, newusername) values ('lgervrau','Laurent.Gervraud');
insert into usermigration (oldusername, newusername) values ('jlrauline','Jean-Luc.Rauline');
insert into usermigration (oldusername, newusername) values ('ebaillie','Emmanuel.Baillie');
insert into usermigration (oldusername, newusername) values ('cgendraud','Christophe.Gendraud');
insert into usermigration (oldusername, newusername) values ('mlemaire','Marion.Lemaire');
insert into usermigration (oldusername, newusername) values ('ymekki','Yassine.Mekki');
insert into usermigration (oldusername, newusername) values ('ppierre','Philippe.Pierre');
insert into usermigration (oldusername, newusername) values ('ogleniss','Olivier.Glenisson');
insert into usermigration (oldusername, newusername) values ('jclevela','James.Cleveland');
insert into usermigration (oldusername, newusername) values ('jfcollin','Jean-francois.Collin');
insert into usermigration (oldusername, newusername) values ('ssablan','Scott.Sablan');
insert into usermigration (oldusername, newusername) values ('sdubus','Sandrine.Dubus');
insert into usermigration (oldusername, newusername) values ('fperrein','Francois.Perrein');
insert into usermigration (oldusername, newusername) values ('EAPFELSTAEDT','Enrico.Apfelstaedt');
insert into usermigration (oldusername, newusername) values ('twattecamps','Thomas.Wattecamps');
insert into usermigration (oldusername, newusername) values ('apouyadou','Arnaud.Pouyadou');
insert into usermigration (oldusername, newusername) values ('gpernot','Guillaume.Pernot');
insert into usermigration (oldusername, newusername) values ('arosal','Albert.Rosal');
insert into usermigration (oldusername, newusername) values ('ggrossi','Gregory.Grossi');
insert into usermigration (oldusername, newusername) values ('ythebault','Yann.Thebault');
insert into usermigration (oldusername, newusername) values ('acollet','Aurelien.Collet');
insert into usermigration (oldusername, newusername) values ('cdsantos','C.Dos-Santos');




SET SQL_SAFE_UPDATES=0; 

update jiraissue x inner join usermigration u on
x.reporter = u.oldusername
set x.reporter = u.newusername;

update jiraissue x inner join usermigration u on
x.assignee = u.oldusername
set x.assignee = u.newusername;

update jiraaction x inner join usermigration u on
x.AUTHOR = u.oldusername
set x.AUTHOR = u.newusername;

update jiraaction x inner join usermigration u on
x.UPDATEAUTHOR = u.oldusername
set x.UPDATEAUTHOR = u.newusername;

update changegroup x inner join usermigration u on
x.AUTHOR = u.oldusername
set x.AUTHOR = u.newusername;

update changeitem x inner join usermigration u on
x.OLDVALUE = u.oldusername
set x.OLDVALUE = u.newusername
where x.field='assignee';

update changeitem x inner join usermigration u on
x.NEWVALUE = u.oldusername
set x.NEWVALUE = u.newusername
where x.field='assignee';

update searchrequest x inner join usermigration u on
x.authorname = u.oldusername
set x.authorname = u.newusername;

update searchrequest x inner join usermigration u on
x.username = u.oldusername
set x.username = u.newusername;

update schemepermissions x inner join usermigration u on
x.perm_parameter = u.oldusername
set x.perm_parameter = u.newusername
where x.perm_type='user';

update membershipbase x inner join usermigration u on
x.USER_NAME = u.oldusername
set x.USER_NAME = u.newusername;

update OS_CURRENTSTEP x inner join usermigration u on
x.owner = u.oldusername
set x.owner = u.newusername;

update OS_CURRENTSTEP x inner join usermigration u on
x.caller = u.oldusername
set x.caller = u.newusername;

update OS_HISTORYSTEP x inner join usermigration u on
x.owner = u.oldusername
set x.owner = u.newusername;

update OS_HISTORYSTEP x inner join usermigration u on
x.caller = u.oldusername
set x.caller = u.newusername;

update fileattachment x inner join usermigration u on
x.author = u.oldusername
set x.author = u.newusername;

update filtersubscription x inner join usermigration u on
x.username = u.oldusername
set x.username = u.newusername;

update project x inner join usermigration u on
x.lead = u.oldusername
set x.lead = u.newusername;

update userbase x inner join usermigration u on
x.username = u.oldusername
set x.username = u.newusername;

update customfieldvalue x inner join usermigration u on
x.stringvalue = u.oldusername
set x.stringvalue = u.newusername;

update columnlayout x inner join usermigration u on
x.username = u.oldusername
set x.username = u.newusername;

update portalpage x inner join usermigration u on
x.username = u.oldusername
set x.username = u.newusername;

update component x inner join usermigration u on
x.LEAD = u.oldusername
set x.LEAD = u.newusername;

update jiraworkflows x inner join usermigration u on
x.creatorname = u.oldusername
set x.creatorname = u.newusername;

update userassociation x inner join usermigration u on
x.SOURCE_NAME = u.oldusername
set x.SOURCE_NAME = u.newusername;

update cwd_membership x inner join usermigration u on
x.child_name = u.oldusername
set x.child_name = u.newusername;

update cwd_membership x inner join usermigration u on
x.lower_child_name = u.oldusername
set x.lower_child_name = LOWER(u.newusername);

update cwd_user x inner join usermigration u on
x.user_name = u.oldusername
set x.user_name = u.newusername,active=0;

update cwd_user x inner join usermigration u on
x.lower_user_name = u.oldusername
set x.lower_user_name = u.newusername,active=0 where directory_id!=10100;

update external_entities x inner join usermigration u on
x.NAME = u.oldusername
set x.NAME = u.newusername;


Create table tempo as select x.id as id 
	from favouriteassociations x 
	inner join usermigration u on (lower(x.USERNAME)= lower(u.oldusername))
	inner join favouriteassociations b on (lower(u.newusername) = lower(b.username) and x.entitytype=b.entitytype and x.entityid=b.entityid);

DELETE FROM favouriteassociations
WHERE id in ( select id from tempo );

update favouriteassociations x inner join usermigration u on
x.USERNAME = u.oldusername
set x.USERNAME = u.newusername;

Drop table tempo;

Create table tempo as select x.id as id
	from userhistoryitem x 
	inner join usermigration u on (lower(x.USERNAME)= lower(u.oldusername))
	inner join userhistoryitem b on (lower(u.newusername) = lower(b.username) and x.entitytype=b.entitytype and x.entityid=b.entityid);

DELETE FROM userhistoryitem 
WHERE id in (select id from tempo);

update userhistoryitem x inner join usermigration u on
x.USERNAME = u.oldusername
set x.USERNAME = u.newusername;

Drop table tempo;

Create table tempo as select x.id as id
from userhistoryitem x 
inner join usermigration u on (lower(x.entityid)= lower(u.oldusername))
inner join userhistoryitem b on (lower(u.newusername) = lower(b.entityid) and x.entitytype=b.entitytype and x.username=b.username);

DELETE FROM userhistoryitem 
WHERE id in (select id from tempo);

update userhistoryitem x inner join usermigration u on
x.entityid = u.oldusername
set x.entityid = u.newusername
where entitytype = 'Assignee';

Drop table tempo;

update worklog x inner join usermigration u on
x.AUTHOR = u.oldusername
set x.AUTHOR = u.newusername;

update worklog x inner join usermigration u on
x.UPDATEAUTHOR = u.oldusername
set x.UPDATEAUTHOR = u.newusername;

update cwd_user set active=0 where user_name ='admin';
update cwd_user set active=0 where user_name ='mschauvi';
update cwd_user set active=0 where user_name ='test';
update cwd_user set active=0 where user_name ='jdijoux';
update cwd_user set active=0 where user_name ='vincent';
update cwd_user set active=0 where user_name ='sanneix';
update cwd_user set active=0 where user_name ='aboli';
update cwd_user set active=0 where user_name ='usergpo';
update cwd_user set active=0 where user_name ='cguyot';
update cwd_user set active=0 where user_name ='prod';
update cwd_user set active=0 where user_name ='abregger';
update cwd_user set active=0 where user_name ='pvettraino';
update cwd_user set active=0 where user_name ='mchebout';
update cwd_user set active=0 where user_name ='jrouyer';
update cwd_user set active=0 where user_name ='mhini';
update cwd_user set active=0 where user_name ='adminad';
update cwd_user set active=0 where user_name ='pspinosi';
update cwd_user set active=0 where user_name ='extdaniel';
update cwd_user set active=0 where user_name ='slefalher';
update cwd_user set active=0 where user_name ='cbaldy';
update cwd_user set active=0 where user_name ='ghugla';
update cwd_user set active=0 where user_name ='calexandre';
update cwd_user set active=0 where user_name ='usncf';
update cwd_user set active=0 where user_name ='psaucourt';
update cwd_user set active=0 where user_name ='vmeunier';
update cwd_user set active=0 where user_name ='fandre';
update cwd_user set active=0 where user_name ='hfavre';
update cwd_user set active=0 where user_name ='msebboua';
update cwd_user set active=0 where user_name ='adubuc';
update cwd_user set active=0 where user_name ='oboubee';
update cwd_user set active=0 where user_name ='david.ngo';
update cwd_user set active=0 where user_name ='JC.Calvez';
update cwd_user set active=0 where user_name ='Florian.Herve';
update cwd_user set active=0 where user_name ='adrien.fortune';
update cwd_user set active=0 where user_name ='janusz.szpilewski';
update cwd_user set active=0 where user_name ='a.el-berhichi';
update cwd_user set active=0 where user_name ='achea';
update cwd_user set active=0 where user_name ='fbonneau';
update cwd_user set active=0 where user_name ='alazareff';
update cwd_user set active=0 where user_name ='bgelineau';
update cwd_user set active=0 where user_name ='ymarie';
update cwd_user set active=0 where user_name ='dprevot';
update cwd_user set active=0 where user_name ='mlhuillier';
update cwd_user set active=0 where user_name ='mboullenger';
update cwd_user set active=0 where user_name ='mcolinet';
update cwd_user set active=0 where user_name ='jpercheron';
update cwd_user set active=0 where user_name ='jrenaud';
update cwd_user set active=0 where user_name ='tjolivet';
update cwd_user set active=0 where user_name ='mcosta';
update cwd_user set active=0 where user_name ='sungar';
update cwd_user set active=0 where user_name ='clarzul';
update cwd_user set active=0 where user_name ='rlapalme';
update cwd_user set active=0 where user_name ='nbenchalel';
update cwd_user set active=0 where user_name ='sramdani';
update cwd_user set active=0 where user_name ='srakoton';
update cwd_user set active=0 where user_name ='pkormann';
update cwd_user set active=0 where user_name ='fzhan';
update cwd_user set active=0 where user_name ='jdandin';
update cwd_user set active=0 where user_name ='smartins';
update cwd_user set active=0 where user_name ='tbenard';
update cwd_user set active=0 where user_name ='svaury';
update cwd_user set active=0 where user_name ='ahanid';
update cwd_user set active=0 where user_name ='Houda.Chouket';
update cwd_user set active=0 where user_name ='Adrien.Viala';
update cwd_user set active=0 where user_name ='Jean-Pierre.Dubuc';
update cwd_user set active=0 where user_name ='celabdellaoui';
update cwd_user set active=0 where user_name ='svc_valiantys';
update cwd_user set active=0 where user_name ='sperrin';
update cwd_user set active=0 where user_name ='maouar';
update cwd_user set active=0 where user_name ='jccourt';
update cwd_user set active=0 where user_name ='lfenelon';
update cwd_user set active=0 where user_name ='cust-sncf';
update cwd_user set active=0 where user_name ='pdurand';
update cwd_user set active=0 where user_name ='daymard';
update cwd_user set active=0 where user_name ='cjeannin';
update cwd_user set active=0 where user_name ='laposte-arichard';
update cwd_user set active=0 where user_name ='ogoyeau';
update cwd_user set active=0 where user_name ='tdebeler';
update cwd_user set active=0 where user_name ='sbaixas';
update cwd_user set active=0 where user_name ='sfavier';
update cwd_user set active=0 where user_name ='lecteur';
update cwd_user set active=0 where user_name ='visiteur';
update cwd_user set active=0 where user_name ='baube';
update cwd_user set active=0 where user_name ='glecuelle';
update cwd_user set active=0 where user_name ='pmoreau';
update cwd_user set active=0 where user_name ='bbenltaief';
update cwd_user set active=0 where user_name ='nettaher';
update cwd_user set active=0 where user_name ='dgernier';
update cwd_user set active=0 where user_name ='ablin';
update cwd_user set active=0 where user_name ='pgeorge';
update cwd_user set active=0 where user_name ='nduval';
update cwd_user set active=0 where user_name ='gmauboussin';
update cwd_user set active=0 where user_name ='jguidard';
update cwd_user set active=0 where user_name ='emichelin';
update cwd_user set active=0 where user_name ='jduterme';
update cwd_user set active=0 where user_name ='phalnais';
update cwd_user set active=0 where user_name ='mjulou';
update cwd_user set active=0 where user_name ='dbriois';
update cwd_user set active=0 where user_name ='dmalliet';
update cwd_user set active=0 where user_name ='pdubois';
update cwd_user set active=0 where user_name ='cvilleneuve';
update cwd_user set active=0 where user_name ='aboli';
update cwd_user set active=0 where user_name ='fpierre';
update cwd_user set active=0 where user_name ='jhenrot';
update cwd_user set active=0 where user_name ='ddolcimascolo';
update cwd_user set active=0 where user_name ='fbonneau';
update cwd_user set active=0 where user_name ='tcrepin';
update cwd_user set active=0 where user_name ='mbernelas';
update cwd_user set active=0 where user_name ='jmfauger';
update cwd_user set active=0 where user_name ='lsalle';
update cwd_user set active=0 where user_name ='vphilipp';
update cwd_user set active=0 where user_name ='pgaillar';
update cwd_user set active=0 where user_name ='ovanlanduy';
update cwd_user set active=0 where user_name ='ghourlie';
update cwd_user set active=0 where user_name ='kzebboud';
update cwd_user set active=0 where user_name ='obouvet';
update cwd_user set active=0 where user_name ='externe';
update cwd_user set active=0 where user_name ='testrodolph';
update cwd_user set active=0 where user_name ='felix henon';
update cwd_user set active=0 where user_name ='boris.burger';
update cwd_user set active=0 where user_name ='laurene.boucher';
update cwd_user set active=0 where user_name ='abussieras';
update cwd_user set active=0 where user_name ='smoreau';

drop table usermigration;